<div class="content-wrapper">
  <header class="topbar">
    <div class="topbar-left">
      <h1>üí∞ Calculadora de Inter√©s Compuesto - Modo Evaluaci√≥n</h1>
      <p class="muted">Complete los datos, ingrese su f√≥rmula y respuesta, luego eval√∫e</p>
    </div>
  </header>

  <section class="controls-card card">
    <div class="section-header">
      <span class="icon">‚öôÔ∏è</span>
      <h3>Datos del Problema</h3>
    </div>

    <div class="params-grid">

      <!-- Capital -->
      <div class="param-group" *ngIf="incognita !== 'capital'">
        <label class="filter-label">Capital (C) No poner , .</label>
        <input
          type="number"
          [(ngModel)]="capital"
          class="filter-select"
          placeholder="Ingrese capital"
          (keydown)="blockInvalidKeys($event)">
        <small>Valor inicial de la inversi√≥n (S/)</small>
      </div>

      <!-- Tasa -->
      <div class="param-group" *ngIf="incognita !== 'tasa'">
        <label class="filter-label">Tasa de inter√©s anual (%) (i):</label>
        <input
          type="number"
          [(ngModel)]="tasa"
          class="filter-select"
          placeholder="Ingrese tasa en %"
          (keydown)="blockInvalidKeys($event)">
        <small>Tasa de inter√©s anual</small>
      </div>

      <!-- TIEMPO SOLO EN A√ëOS -->
      <div class="param-group" *ngIf="incognita !== 'tiempo'">
        <label class="filter-label">Tiempo (t) en a√±os:</label>
        <input
          type="number"
          [(ngModel)]="tiempo"
          class="filter-select tiempo-input"
          placeholder="Ingrese tiempo en a√±os"
          (keydown)="blockInvalidKeys($event)">
        <small>Duraci√≥n en a√±os</small>
      </div>

      <!-- Capitalizaci√≥n -->
      <div class="param-group">
        <label class="filter-label">Capitalizaci√≥n por a√±o (m):</label>
        <select [(ngModel)]="capitalizacion" class="filter-select">
          <option value="">-- Seleccionar --</option>
          <option value="1">Anual (1)</option>
          <option value="2">Semestral (2)</option>
          <option value="4">Trimestral (4)</option>
          <option value="6">Bimestral (6)</option>
          <option value="12">Mensual (12)</option>
          <option value="24">Quincenal (24)</option>
          <option value="365">Diaria (365)</option>
        </select>
        <small>N√∫mero de capitalizaciones por a√±o</small>
      </div>

      <!-- Inter√©s -->
      <div class="param-group" *ngIf="incognita !== 'interes'">
        <label class="filter-label">Inter√©s (I):</label>
        <input
          type="number"
          [(ngModel)]="interes"
          class="filter-select"
          placeholder="Ingrese inter√©s"
          (keydown)="blockInvalidKeys($event)">
        <small>Inter√©s generado</small>
      </div>

      <!-- Monto -->
      <div class="param-group" *ngIf="incognita !== 'monto'">
        <label class="filter-label">Monto (M):</label>
        <input
          type="number"
          [(ngModel)]="monto"
          class="filter-select"
          placeholder="Ingrese monto"
          (keydown)="blockInvalidKeys($event)">
        <small>Capital final</small>
      </div>

      <!-- Inc√≥gnita -->
      <div class="param-group">
        <label class="filter-label">Inc√≥gnita a calcular:</label>
        <select [(ngModel)]="incognita" (change)="onIncognitaChange()" class="filter-select">
          <option value="capital">Capital (C)</option>
          <option value="tasa">Tasa de Inter√©s (i)</option>
          <option value="tiempo">Tiempo (n)</option>
          <option value="monto">Monto (M)</option>
          <option value="interes">Inter√©s (I)</option>
        </select>
        <small>Seleccione qu√© desea calcular</small>
      </div>

    </div>

    <!-- RESPUESTA DEL ESTUDIANTE -->
    <div class="respuesta-estudiante">
      <div class="section-header">
        <span class="icon">‚úèÔ∏è</span>
        <h3>Su Respuesta</h3>
      </div>

      <div class="param-group">
        <label class="filter-label">Modo de f√≥rmula:</label>
        <div class="modo-formula-buttons">
          <button type="button" class="btn-modo" [class.active]="modoFormula === 'manual'"
                  (click)="modoFormula = 'manual'; cambiarModoFormula()">
            üìù Manual
          </button>
          <button type="button" class="btn-modo" [class.active]="modoFormula === 'automatico'"
                  (click)="modoFormula = 'automatico'; cambiarModoFormula()">
            ‚ö° Autom√°tico
          </button>
        </div>
      </div>

      <div class="params-grid">
        <div class="param-group">
          <label class="filter-label">F√≥rmula utilizada:</label>
          <input type="text"
                 [(ngModel)]="formulaEstudiante"
                 class="filter-select formula-input"
                 placeholder="Ej: M = C √ó (1 + i/m)^(m√ón)"
                 [disabled]="modoFormula === 'automatico'">
          <small>Ingrese la f√≥rmula usada</small>
        </div>

        <div class="param-group">
          <label class="filter-label">Su respuesta para {{ getIncognitaLabel() }}:</label>
          <input
            type="number"
            [(ngModel)]="respuestaEstudiante"
            class="filter-select"
            placeholder="Ingrese su resultado"
            (keydown)="blockInvalidKeys($event)">
          <small>Ingrese su valor</small>
        </div>
      </div>
    </div>

    <div class="actions">
      <button class="btn-evaluar" (click)="evaluarRespuesta()">üìù Evaluar Respuesta</button>
      <button class="btn-reset" (click)="reset()">üîÑ Reiniciar</button>
    </div>
  </section>

  <br><br><br>

  <!-- RESULTADO -->
  <section class="evaluacion-card card" *ngIf="mostrarEvaluacion"
           [class.correcta]="esCorrecto" [class.incorrecta]="!esCorrecto">

    <div class="section-header">
      <span class="icon">{{ esCorrecto ? '‚úÖ' : '‚ùå' }}</span>
      <h3>Resultado de la Evaluaci√≥n</h3>
    </div>

    <div class="evaluacion-content">

      <div class="evaluacion-mensaje">{{ mensajeEvaluacion }}</div>

      <div class="proceso-calculo">
        <h4>üìä Proceso de C√°lculo Correcto:</h4>
        <div class="proceso-texto">
          <div *ngFor="let paso of procesoCalculo" class="paso-calculo">
            {{ paso }}
          </div>
        </div>
      </div>

      <!-- üîÅ SIEMPRE muestra el resultado correcto -->
      <div class="evaluacion-detalles">
        <p *ngIf="!esCorrecto">
          <strong>F√≥rmula correcta:</strong> {{ getFormulaCorrecta() }}
        </p>

        <p>
          <strong>Resultado correcto:</strong>
          <span *ngIf="incognita !== 'tasa' && incognita !== 'tiempo'">
            S/ {{ resultadoCorrecto | number:'1.2-2' }}
          </span>
          <span *ngIf="incognita === 'tasa'">
            {{ resultadoCorrecto | number:'1.2-2' }}%
          </span>
          <span *ngIf="incognita === 'tiempo'">
            {{ resultadoCorrecto | number:'1.2-2' }} a√±os
          </span>
        </p>
      </div>

    </div>
  </section>

</div>
